define(["jquery","core/pubsub","core/url"],function(a,b,c){var d=[],e=560;return{init:function(){if(0!==a(".preferences-page-container").length||0!==a(".message-app.main").length||0==a("#page-message-edit").length&&0==a("#page-message-index").length)0!=a("#page-user-profile").length&&b.subscribe("message-drawer-create-conversation-with-user",function(a){window.location=c.relativeUrl("/message/index.php?id="+a)});else{a(".message-app.drawer").css("visibility","visible"),a(".message-app.drawer").animate({width:"100%"},0),document.addEventListener("messages-drawer:toggle",function(){(a("#page-message-edit").length||a("#page-message-index").length)&&(a(".block_settings").hasClass("state-visible")||a(".block_settings").hasClass("state-visible")?a(window).width()<e?a(".message-app.drawer").hide():a(".message-app.drawer").animate({width:"50%"},0):a(window).width()<e?a(".message-app.drawer").show():a(".message-app.drawer").animate({width:"100%"},0))}),document.addEventListener("messages-drawer:pm-toggle",function(){(a("#page-message-edit").length||a("#page-message-index").length)&&(a(".snap-pm-open").length?a(".message-app.drawer").hide():a(".message-app.drawer").show())});var f=a("div.popover-region");f.on("popoverregion:menuopened",function(){if(a("#page-message-edit").length||a("#page-message-index").length){var b=a(this).attr("id");d.indexOf(b)==-1&&d.push(b),d.length>0&&(a(window).width()<e?a(".message-app.drawer").hide():a(".message-app.drawer").animate({width:"50%"},0))}}).bind(),f.on("popoverregion:menuclosed",function(){if(a("#page-message-edit").length||a("#page-message-index").length){var b=a(this).attr("id"),c=d.indexOf(b);d.splice(c,1),0==d.length&&(a(window).width()<e?a(".message-app.drawer").show():a(".message-app.drawer").animate({width:"100%"},0))}}).bind()}}}});